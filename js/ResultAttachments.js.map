{"version":3,"sources":["./src/ui/ResultAttachments/ResultAttachments.ts","./sass/_ResultAttachments.scss","./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts"],"names":[],"mappings":"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","file":"ResultAttachments.js","sourcesContent":["import { Template } from '../Templates/Template';\nimport { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { DefaultResultAttachmentTemplate } from './DefaultResultAttachmentTemplate';\nimport { IQueryResult } from '../../rest/QueryResult';\nimport { Utils } from '../../utils/Utils';\nimport { QueryUtils } from '../../utils/QueryUtils';\nimport { Initialization, IInitializationParameters } from '../Base/Initialization';\nimport { Assert } from '../../misc/Assert';\nimport { $$ } from '../../utils/Dom';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\n\nimport 'styling/_ResultAttachments';\n\nexport interface IResultAttachmentsOptions {\n  resultTemplate?: Template;\n  subResultTemplate?: Template;\n  maximumAttachmentLevel?: number;\n}\n\n/**\n * The `ResultAttachments` component renders attachments in a result set, for example when displaying emails. This\n * component is usable inside a result template when there is an active [`Folding`]{@link Folding} component in the\n * page.\n *\n * This component is a result template component (see [Result Templates](https://developers.coveo.com/x/aIGfAQ)).\n */\nexport class ResultAttachments extends Component {\n  static ID = 'ResultAttachments';\n\n  static doExport = () => {\n    exportGlobally({\n      'ResultAttachments': ResultAttachments,\n      'DefaultResultAttachmentTemplate': DefaultResultAttachmentTemplate\n    });\n  }\n\n  /**\n   * The options for the component\n   * @componentOptions\n   */\n  static options: IResultAttachmentsOptions = {\n\n    /**\n     * Specifies the template to use to render each attachment for a top result.\n     *\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\n     * CSS selector (see {@link TemplateCache}).\n     *\n     * **Examples:**\n     *\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-result-template-id=\"Foo\"></div>\n     * ```\n     *\n     * Specifying a previously registered template by referring to a CSS selector:\n     *\n     * ```html\n     * <div class='CoveoResultAttachments' data-result-template-selector=\".Foo\"></div>\n     * ```\n     *\n     * If you do not specify a custom folding template, the component uses the default result attachment template.\n     */\n    resultTemplate: ComponentOptions.buildTemplateOption({ defaultFunction: (e) => new DefaultResultAttachmentTemplate() }),\n\n    /**\n     * Specifies the template to use to render sub-attachments, which are attachments within attachments, for example\n     * when multiple files are embedded within a `.zip` attachment.\n     *\n     * Sub-attachments can themselves contain sub-attachments, and so on up to a certain level (see the\n     * [`maximumAttachmentLevel`]{@link ResultAttachments.options.maximumAttachmentLevel} option).\n     *\n     * You can specify a previously registered template to use either by referring to its HTML `id` attribute or to a\n     * CSS selector (see {@link TemplateCache}).\n     *\n     * **Example:**\n     *\n     * Specifying a previously registered template by referring to its HTML `id` attribute:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-id=\"Foo\"></div>\n     * ```\n     *\n     * Specifying a previously registered template by referring to a CSS selector:\n     *\n     * ```html\n     * <div class=\"CoveoResultAttachments\" data-sub-result-template-selector=\".Foo\"></div>\n     * ```\n     *\n     * By default, this option uses the same template you specify for the\n     * [`resultTemplate`]{@link ResultAttachments.options.resultTemplate} option.\n     */\n    subResultTemplate: ComponentOptions.buildTemplateOption({ postProcessing: (value: Template, options: IResultAttachmentsOptions) => value != null ? value : options.resultTemplate }),\n\n    /**\n     * Specifies the maximum nesting depth. Beyond this depth, the component stops rendering sub-attachments.\n     *\n     * Default value is `5`. Minimum value is `0`.\n     */\n    maximumAttachmentLevel: ComponentOptions.buildNumberOption({ defaultValue: 5, min: 0 })\n  };\n\n  private attachments: IQueryResult[];\n\n  /**\n   * Creates a new `ResultAttachments` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `ResultAttachments` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param result The result to associate the component with.\n   * @param attachmentLevel The nesting depth.\n   */\n  constructor(public element: HTMLElement, public options?: IResultAttachmentsOptions, public bindings?: IComponentBindings, result?: IQueryResult, public attachmentLevel = 0) {\n    super(element, ResultAttachments.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, ResultAttachments, options);\n\n    this.attachments = result.attachments;\n    if (Utils.isNonEmptyArray(this.attachments)) {\n      this.renderAttachments();\n    }\n  }\n\n  private renderAttachments() {\n    _.each(this.attachments, (attachment) => {\n      QueryUtils.setStateObjectOnQueryResult(this.queryStateModel.get(), attachment);\n      QueryUtils.setSearchInterfaceObjectOnQueryResult(this.searchInterface, attachment);\n      let subTemplatePromise = this.attachmentLevel > 0 ? this.options.subResultTemplate.instantiateToElement(attachment) : this.options.resultTemplate.instantiateToElement(attachment);\n\n      subTemplatePromise.then((container: HTMLElement) => {\n        this.autoCreateComponentsInsideResult(container, _.extend({}, attachment, { attachments: [] }));\n\n        $$(container).addClass('coveo-result-attachments-container');\n        this.element.appendChild(container);\n\n        if (this.attachmentHasSubAttachment(attachment) && this.attachmentLevel < this.options.maximumAttachmentLevel) {\n          var childAttachmentContainer = $$('div').el;\n          container.appendChild(childAttachmentContainer);\n          new ResultAttachments(childAttachmentContainer, this.options, this.bindings, attachment, this.attachmentLevel + 1);\n        }\n      });\n    });\n  }\n\n  private attachmentHasSubAttachment(attachment: IQueryResult) {\n    if (Utils.isNonEmptyArray(attachment.attachments)) {\n      return true;\n    } else if (Utils.isNonEmptyArray(attachment.childResults)) {\n      attachment.attachments = attachment.childResults;\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  private autoCreateComponentsInsideResult(element: HTMLElement, result: IQueryResult) {\n    Assert.exists(element);\n    var initOptions = this.searchInterface.options;\n    var initParameters: IInitializationParameters = {\n      options: initOptions,\n      bindings: this.getBindings(),\n      result: result\n    };\n    Initialization.automaticallyCreateComponentsInside(element, initParameters, [ResultAttachments.ID]);\n  }\n}\n\nInitialization.registerAutoCreateComponent(ResultAttachments);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/ResultAttachments.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_ResultAttachments.scss\n// module id = 606\n// module chunks = 30 70","import { Template } from '../Templates/Template';\nimport { IQueryResult } from '../../rest/QueryResult';\n\n\nexport class DefaultResultAttachmentTemplate extends Template {\n\n  constructor() {\n    super();\n  }\n\n  instantiateToString(queryResult?: IQueryResult): string {\n    return '<div><span class=\"CoveoIcon\"></span> <a class=\"CoveoResultLink\"></a> <span class=\"CoveoQuickview\"></span></div>';\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/ResultAttachments/DefaultResultAttachmentTemplate.ts"],"sourceRoot":""}