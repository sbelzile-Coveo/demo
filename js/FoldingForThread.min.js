webpackJsonpCoveo__temporary([24,41],{247:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),o=n(440),s=n(9),l=n(5),u=n(7),d=n(11),a=n(2),p=n(3),c=n(44),h=n(1),f=n(4),m=function(t){function e(n,i,r){var o=t.call(this,n,e.ID,r)||this;return o.element=n,o.options=i,o.options=s.ComponentOptions.initComponentOptions(n,e,i),u.Assert.check(l.Utils.isCoveoField(o.options.field),o.options.field+" is not a valid field"),u.Assert.exists(o.options.maximumExpandedResults),o.bind.onRootElement(d.QueryEvents.buildingQuery,o.handleBuildingQuery),o.bind.onRootElement(d.QueryEvents.preprocessResults,o.handlepreprocessResults),o}return i(e,t),e.foldWithParent=function(t){var n={score:Number.NEGATIVE_INFINITY,children:[],result:{raw:!1}};h.each(t,function(t,i){var r=e.findUniqueId(n.children,t.uniqueId);if(null==t.parentResult||t.parentResult.uniqueId==t.uniqueId)null==r&&(r={result:t,score:i,children:[]},n.children.push(r),r.parent=n);else{null!=r?(r.score=Math.min(i,r.score),r.parent.children=h.without(r.parent.children,r)):r={result:t,score:i,children:[]};var o=e.findUniqueId(n.children,t.parentResult.uniqueId);null==o&&(o={result:t.parentResult,score:Number.POSITIVE_INFINITY,children:[]},n.children.push(o),o.parent=n),o.children.push(r),r.parent=o;for(var s=o;null!=s&&r.score<s.score;)s.score=r.score,s=s.parent}});var i=e.resultNodeToQueryResult(n);return h.each(i.attachments,function(t){return t.parentResult=null}),i.attachments},e.defaultGetResult=function(t){var n=t.childResults||[];n.unshift(t),t.childResults=[],n=e.foldWithParent(n);var i=n.shift();return i.childResults=n,i},e.defaultGetMoreResults=function(t){return e.foldWithParent(t)},e.resultNodeToQueryResult=function(t){var n=t.result;return n.attachments=h.map(h.sortBy(t.children,"score"),e.resultNodeToQueryResult),n.parentResult=null!=t.parent?t.parent.result:null,n},e.findUniqueId=function(t,n){for(var i=0;i<t.length;i++){if(t[i].result.uniqueId==n)return t[i];var r=e.findUniqueId(t[i].children,n);if(null!=r)return r}return null},e.prototype.handleBuildingQuery=function(t){u.Assert.exists(t),this.disabled||(t.queryBuilder.childField=this.options.childField,t.queryBuilder.parentField=this.options.parentField,t.queryBuilder.filterField=this.options.field,t.queryBuilder.filterFieldRange=this.options.range,t.queryBuilder.requiredFields.push(this.options.field),null!=this.options.childField&&t.queryBuilder.requiredFields.push(this.options.childField),null!=this.options.parentField&&t.queryBuilder.requiredFields.push(this.options.parentField))},e.prototype.handlepreprocessResults=function(t){u.Assert.exists(t),u.Assert.check(!t.results._folded,"Two or more Folding components are active at the same time for the same Tab. Cannot process the results."),t.results._folded=!0;var n=t.results,i=this.options.getResult||e.defaultGetResult;n.results=h.map(n.results,i),this.addLoadMoreHandler(n.results,t.query)},e.prototype.addLoadMoreHandler=function(t,e){var n=this;return h.map(t,function(t){return n.options.enableExpand&&!l.Utils.isNullOrUndefined(l.Utils.getFieldValue(t,n.options.field))&&(t.moreResults=function(){return n.moreResults(t,e)}),t})},e.prototype.moreResults=function(t,e){var n=this,i=h.clone(e),r=new c.QueryBuilder;i.numberOfResults=this.options.maximumExpandedResults;var o=l.Utils.getFieldValue(t,this.options.field);return l.Utils.isNonEmptyString(o)&&(r.advancedExpression.addFieldExpression(this.options.field,"=",[o]),i.aq=r.build().aq),l.Utils.isNonEmptyString(e.q)&&(e.enableQuerySyntax?i.q="( "+e.q+" ) OR @uri":(i.enableQuerySyntax=!0,i.q="( <@- "+e.q+" -@> ) OR @uri")),l.Utils.isNonEmptyString(this.options.expandExpression)&&(i.cq=this.options.expandExpression),null!=this.options.parentField&&(i.parentField=this.options.parentField),null!=this.options.childField&&(i.childField=this.options.childField),i.filterField=null,i.filterFieldRange=null,i.firstResult=0,this.options.rearrange?(this.options.rearrange.putInQueryBuilder(r),i.sortCriteria=r.sortCriteria,i.sortField=r.sortField):(i.sortCriteria=e.sortCriteria,i.sortField=e.sortField),this.queryController.getEndpoint().search(i).then(function(t){return n.handlePreprocessMoreResults(t),t.results})},e.prototype.handlePreprocessMoreResults=function(t){var n=this.options.getMoreResults||e.defaultGetMoreResults;t.results=n(t.results),p.$$(this.element).trigger(d.QueryEvents.preprocessMoreResults,{results:t})},e}(r.Component);m.ID="Folding",m.doExport=function(){f.exportGlobally({Folding:m})},m.options={field:s.ComponentOptions.buildFieldOption({required:!0}),childField:s.ComponentOptions.buildFieldOption({defaultValue:"@topparentid"}),parentField:s.ComponentOptions.buildFieldOption({defaultValue:"@containsattachment"}),range:s.ComponentOptions.buildNumberOption({defaultValue:2,min:0}),rearrange:s.ComponentOptions.buildCustomOption(function(t){return l.Utils.isNonEmptyString(t)?o.SortCriteria.parse(t):null}),enableExpand:s.ComponentOptions.buildBooleanOption({defaultValue:!0}),expandExpression:s.ComponentOptions.buildStringOption({depend:"enableExpand"}),maximumExpandedResults:s.ComponentOptions.buildNumberOption({defaultValue:100,min:1,depend:"enableExpand"}),getResult:s.ComponentOptions.buildCustomOption(function(){return null}),getMoreResults:s.ComponentOptions.buildCustomOption(function(){return null})},e.Folding=m,a.Initialization.registerAutoCreateComponent(m)},302:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(247),o=n(2),s=n(4),l=function(t){function e(e,n,i){var o=t.call(this,e,n,i)||this;return o.element=e,o.options=n,o.options.getMoreResults=function(t){return r.Folding.foldWithParent(t)[0].attachments},o.options.getResult=function(t){var e=r.Folding.defaultGetResult(t);return e.childResults=e.attachments,e.attachments=[],e},o}return i(e,t),e}(r.Folding);l.ID="FoldingForThread",l.doExport=function(){s.exportGlobally({FoldingForThread:l})},e.FoldingForThread=l,o.Initialization.registerAutoCreateComponent(l)},440:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=n(5),o=n(1),s=function(){function t(e,n){void 0===n&&(n=""),this.sort=e,this.direction=n,i.Assert.isNonEmptyString(e),i.Assert.check(o.contains(t.validSorts,e)||t.sortIsField(e)),t.sortNeedsDirection(e)?i.Assert.check(o.contains(t.validDirections,n)):i.Assert.check(""==n)}return t.parse=function(e){i.Assert.isNonEmptyString(e);var n=e.match(/\S+/g);return new t(n[0],n[1])},t.prototype.putInQueryBuilder=function(e){i.Assert.exists(e),t.sortIsField(this.sort)?(e.sortCriteria="field"+this.direction,e.sortField=this.sort):""!=this.direction?e.sortCriteria=this.sort+this.direction:e.sortCriteria=this.sort},t.prototype.getValueFromResult=function(e){return i.Assert.exists(e),t.sortIsField(this.sort)?r.Utils.getFieldValue(e,this.sort):"date"==this.sort?e.raw.date:void i.Assert.fail("Cannot retrieve value: "+this.sort)},t.prototype.toString=function(){return r.Utils.isNonEmptyString(this.direction)?this.sort+" "+this.direction:this.sort},t.prototype.equals=function(t){return i.Assert.exists(t),t.sort==this.sort&&t.direction==this.direction},t.sortIsField=function(t){return"@"==t.charAt(0)},t.sortNeedsDirection=function(e){return o.contains(t.sortsNeedingDirection,e)||t.sortIsField(e)},t}();s.validSorts=["relevancy","date","qre"],s.sortsNeedingDirection=["date"],s.validDirections=["ascending","descending"],e.SortCriteria=s}});