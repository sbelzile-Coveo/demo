webpackJsonpCoveo__temporary([41],{247:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(8),s=i(440),o=i(9),l=i(5),u=i(7),d=i(11),a=i(2),p=i(3),c=i(44),h=i(1),f=i(4),m=function(e){function t(i,n,r){var s=e.call(this,i,t.ID,r)||this;return s.element=i,s.options=n,s.options=o.ComponentOptions.initComponentOptions(i,t,n),u.Assert.check(l.Utils.isCoveoField(s.options.field),s.options.field+" is not a valid field"),u.Assert.exists(s.options.maximumExpandedResults),s.bind.onRootElement(d.QueryEvents.buildingQuery,s.handleBuildingQuery),s.bind.onRootElement(d.QueryEvents.preprocessResults,s.handlepreprocessResults),s}return n(t,e),t.foldWithParent=function(e){var i={score:Number.NEGATIVE_INFINITY,children:[],result:{raw:!1}};h.each(e,function(e,n){var r=t.findUniqueId(i.children,e.uniqueId);if(null==e.parentResult||e.parentResult.uniqueId==e.uniqueId)null==r&&(r={result:e,score:n,children:[]},i.children.push(r),r.parent=i);else{null!=r?(r.score=Math.min(n,r.score),r.parent.children=h.without(r.parent.children,r)):r={result:e,score:n,children:[]};var s=t.findUniqueId(i.children,e.parentResult.uniqueId);null==s&&(s={result:e.parentResult,score:Number.POSITIVE_INFINITY,children:[]},i.children.push(s),s.parent=i),s.children.push(r),r.parent=s;for(var o=s;null!=o&&r.score<o.score;)o.score=r.score,o=o.parent}});var n=t.resultNodeToQueryResult(i);return h.each(n.attachments,function(e){return e.parentResult=null}),n.attachments},t.defaultGetResult=function(e){var i=e.childResults||[];i.unshift(e),e.childResults=[],i=t.foldWithParent(i);var n=i.shift();return n.childResults=i,n},t.defaultGetMoreResults=function(e){return t.foldWithParent(e)},t.resultNodeToQueryResult=function(e){var i=e.result;return i.attachments=h.map(h.sortBy(e.children,"score"),t.resultNodeToQueryResult),i.parentResult=null!=e.parent?e.parent.result:null,i},t.findUniqueId=function(e,i){for(var n=0;n<e.length;n++){if(e[n].result.uniqueId==i)return e[n];var r=t.findUniqueId(e[n].children,i);if(null!=r)return r}return null},t.prototype.handleBuildingQuery=function(e){u.Assert.exists(e),this.disabled||(e.queryBuilder.childField=this.options.childField,e.queryBuilder.parentField=this.options.parentField,e.queryBuilder.filterField=this.options.field,e.queryBuilder.filterFieldRange=this.options.range,e.queryBuilder.requiredFields.push(this.options.field),null!=this.options.childField&&e.queryBuilder.requiredFields.push(this.options.childField),null!=this.options.parentField&&e.queryBuilder.requiredFields.push(this.options.parentField))},t.prototype.handlepreprocessResults=function(e){u.Assert.exists(e),u.Assert.check(!e.results._folded,"Two or more Folding components are active at the same time for the same Tab. Cannot process the results."),e.results._folded=!0;var i=e.results,n=this.options.getResult||t.defaultGetResult;i.results=h.map(i.results,n),this.addLoadMoreHandler(i.results,e.query)},t.prototype.addLoadMoreHandler=function(e,t){var i=this;return h.map(e,function(e){return i.options.enableExpand&&!l.Utils.isNullOrUndefined(l.Utils.getFieldValue(e,i.options.field))&&(e.moreResults=function(){return i.moreResults(e,t)}),e})},t.prototype.moreResults=function(e,t){var i=this,n=h.clone(t),r=new c.QueryBuilder;n.numberOfResults=this.options.maximumExpandedResults;var s=l.Utils.getFieldValue(e,this.options.field);return l.Utils.isNonEmptyString(s)&&(r.advancedExpression.addFieldExpression(this.options.field,"=",[s]),n.aq=r.build().aq),l.Utils.isNonEmptyString(t.q)&&(t.enableQuerySyntax?n.q="( "+t.q+" ) OR @uri":(n.enableQuerySyntax=!0,n.q="( <@- "+t.q+" -@> ) OR @uri")),l.Utils.isNonEmptyString(this.options.expandExpression)&&(n.cq=this.options.expandExpression),null!=this.options.parentField&&(n.parentField=this.options.parentField),null!=this.options.childField&&(n.childField=this.options.childField),n.filterField=null,n.filterFieldRange=null,n.firstResult=0,this.options.rearrange?(this.options.rearrange.putInQueryBuilder(r),n.sortCriteria=r.sortCriteria,n.sortField=r.sortField):(n.sortCriteria=t.sortCriteria,n.sortField=t.sortField),this.queryController.getEndpoint().search(n).then(function(e){return i.handlePreprocessMoreResults(e),e.results})},t.prototype.handlePreprocessMoreResults=function(e){var i=this.options.getMoreResults||t.defaultGetMoreResults;e.results=i(e.results),p.$$(this.element).trigger(d.QueryEvents.preprocessMoreResults,{results:e})},t}(r.Component);m.ID="Folding",m.doExport=function(){f.exportGlobally({Folding:m})},m.options={field:o.ComponentOptions.buildFieldOption({required:!0}),childField:o.ComponentOptions.buildFieldOption({defaultValue:"@topparentid"}),parentField:o.ComponentOptions.buildFieldOption({defaultValue:"@containsattachment"}),range:o.ComponentOptions.buildNumberOption({defaultValue:2,min:0}),rearrange:o.ComponentOptions.buildCustomOption(function(e){return l.Utils.isNonEmptyString(e)?s.SortCriteria.parse(e):null}),enableExpand:o.ComponentOptions.buildBooleanOption({defaultValue:!0}),expandExpression:o.ComponentOptions.buildStringOption({depend:"enableExpand"}),maximumExpandedResults:o.ComponentOptions.buildNumberOption({defaultValue:100,min:1,depend:"enableExpand"}),getResult:o.ComponentOptions.buildCustomOption(function(){return null}),getMoreResults:o.ComponentOptions.buildCustomOption(function(){return null})},t.Folding=m,a.Initialization.registerAutoCreateComponent(m)},440:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(7),r=i(5),s=i(1),o=function(){function e(t,i){void 0===i&&(i=""),this.sort=t,this.direction=i,n.Assert.isNonEmptyString(t),n.Assert.check(s.contains(e.validSorts,t)||e.sortIsField(t)),e.sortNeedsDirection(t)?n.Assert.check(s.contains(e.validDirections,i)):n.Assert.check(""==i)}return e.parse=function(t){n.Assert.isNonEmptyString(t);var i=t.match(/\S+/g);return new e(i[0],i[1])},e.prototype.putInQueryBuilder=function(t){n.Assert.exists(t),e.sortIsField(this.sort)?(t.sortCriteria="field"+this.direction,t.sortField=this.sort):""!=this.direction?t.sortCriteria=this.sort+this.direction:t.sortCriteria=this.sort},e.prototype.getValueFromResult=function(t){return n.Assert.exists(t),e.sortIsField(this.sort)?r.Utils.getFieldValue(t,this.sort):"date"==this.sort?t.raw.date:void n.Assert.fail("Cannot retrieve value: "+this.sort)},e.prototype.toString=function(){return r.Utils.isNonEmptyString(this.direction)?this.sort+" "+this.direction:this.sort},e.prototype.equals=function(e){return n.Assert.exists(e),e.sort==this.sort&&e.direction==this.direction},e.sortIsField=function(e){return"@"==e.charAt(0)},e.sortNeedsDirection=function(t){return s.contains(e.sortsNeedingDirection,t)||e.sortIsField(t)},e}();o.validSorts=["relevancy","date","qre"],o.sortsNeedingDirection=["date"],o.validDirections=["ascending","descending"],t.SortCriteria=o}});