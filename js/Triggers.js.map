{"version":3,"sources":["./src/ui/Triggers/Triggers.ts","./sass/_Triggers.scss"],"names":[],"mappings":"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","file":"Triggers.js","sourcesContent":["import { Component } from '../Base/Component';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Assert } from '../../misc/Assert';\nimport { QueryEvents, IQuerySuccessEventArgs } from '../../events/QueryEvents';\nimport { ITriggerNotify, ITriggerExecute, ITriggerRedirect, ITriggerQuery, ITrigger } from '../../rest/Trigger';\nimport { $$ } from '../../utils/Dom';\nimport { IAnalyticsTriggerNotify, analyticsActionCauseList, IAnalyticsTriggerRedirect, IAnalyticsTriggerQuery, IAnalyticsTriggerExecute } from '../Analytics/AnalyticsActionListMeta';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport { Initialization } from '../Base/Initialization';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\n\nimport 'styling/_Triggers';\n\nexport interface ITriggersOptions {\n}\n\n/**\n * The Triggers component enables the use of triggers (`notify`, `execute`, `query`, `redirect`) generated by the Coveo\n * Search API (see [Trigger](https://developers.coveo.com/x/lIM9AQ)) in the query pipeline (see\n * [Managing the Query Pipeline](https://developers.coveo.com/x/KYOy)).\n */\nexport class Triggers extends Component {\n  static ID = 'Triggers';\n  static options: ITriggersOptions = {};\n\n  static doExport = () => {\n    exportGlobally({\n      'Triggers': Triggers\n    });\n  }\n\n  /**\n   * The list of notifications returned by the Search API for the current query (via `notify` triggers).\n   *\n   * The Triggers component automatically renders this list visually.\n   */\n  public notifications: string[];\n\n  /**\n   * Creates a new Triggers component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the Triggers component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   * @param _window The window on which to execute the triggers.\n   */\n  constructor(public element: HTMLElement, public options?: ITriggersOptions, public bindings?: IComponentBindings, public _window?: Window) {\n\n    super(element, Triggers.ID, bindings);\n\n    this._window = this._window || window;\n    this.options = ComponentOptions.initComponentOptions(element, Triggers, options);\n    Assert.exists(element);\n    Assert.exists(this.options);\n\n    this.notifications = [];\n\n    this.bind.onRootElement(QueryEvents.querySuccess, this.handleProcessNewQueryResults);\n  }\n\n  private handleProcessNewQueryResults(data: IQuerySuccessEventArgs) {\n    Assert.exists(data);\n    Assert.exists(data.results);\n\n    $$(this.element).empty();\n    this.notifications.length = 0;\n    let showElement = false;\n\n    if (data.results.triggers === undefined) {\n      $$(this.element).toggleClass('coveo-visible', showElement);\n      return;\n    }\n\n    this.executeTriggers(data.results.triggers, 'notify', (trigger: ITriggerNotify) => {\n\n      this.usageAnalytics.logCustomEvent<IAnalyticsTriggerNotify>(analyticsActionCauseList.triggerNotify, {\n        notification: trigger.content\n      }, this.element);\n\n      this.notifications.push(trigger.content);\n      this.element.appendChild($$('div', { className: 'coveo-trigger-notify' }, trigger.content).el);\n\n      showElement = true;\n    });\n\n    this.executeTriggers(data.results.triggers, 'redirect', (trigger: ITriggerRedirect) => {\n\n      this.usageAnalytics.logCustomEvent<IAnalyticsTriggerRedirect>(analyticsActionCauseList.triggerRedirect, {\n        redirectedTo: trigger.content\n      }, this.element);\n\n      this._window.location.replace(trigger.content);\n    }, true);\n\n    this.executeTriggers(data.results.triggers, 'query', (trigger: ITriggerQuery) => {\n      this.queryStateModel.set(QueryStateModel.attributesEnum.q, trigger.content);\n      this.queryController.executeQuery({\n        beforeExecuteQuery: () => {\n          this.usageAnalytics.logCustomEvent<IAnalyticsTriggerQuery>(analyticsActionCauseList.triggerQuery, {\n            query: trigger.content\n          }, this.element);\n        }\n      });\n    }, true);\n\n    this.executeTriggers(data.results.triggers, 'execute', (trigger: ITriggerExecute) => {\n      try {\n        let func: Function = this._window['' + trigger.content.name];\n        if (typeof func === 'function') {\n          let params = _.object(_.map(trigger.content.params, (value, index) => {\n            return ['param' + (index + 1), value];\n          }));\n          params['element'] = this.element;\n\n          this.usageAnalytics.logCustomEvent<IAnalyticsTriggerExecute>(analyticsActionCauseList.triggerExecute, {\n            executed: trigger.content.name\n          }, this.element);\n\n          func.apply(this._window, [params]);\n        } else {\n          this.logger.error(`A trigger tried to call the function '${trigger.content.name}', which doesn't exist.`, this, data.query, trigger);\n        }\n      } catch (error) {\n        this.logger.error(`A trigger called the function '${trigger.content.name}', which threw an error.`, this, data.query, trigger);\n      }\n    });\n\n    $$(this.element).toggleClass('coveo-visible', showElement);\n\n  }\n\n  private executeTriggers(trigger: ITrigger<any>[], type: string, func: (trigger: ITrigger<any>) => any, single: boolean = false) {\n    let triggersOfType = _.filter(trigger, (trigger: ITrigger<any>) => {\n      return trigger.type == type;\n    });\n    let oneOrAllTriggers = _.take(triggersOfType, single ? 1 : Number.MAX_VALUE);\n\n    _.each(oneOrAllTriggers, func);\n  }\n}\n\nInitialization.registerAutoCreateComponent(Triggers);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/Triggers/Triggers.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_Triggers.scss\n// module id = 619\n// module chunks = 51 70"],"sourceRoot":""}